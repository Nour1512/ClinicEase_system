
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Patient Dashboard - Patient List</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

    <link rel="stylesheet" href="{{ url_for('static', filename='styles/patients.css') }}">
</head>
<body>
    <div class="app-shell">


        {% include 'base/sidebar.html' %}

        <main class="main">
            <div class="topbar">
                <div class="search-wrapper">
                    <span class="search-icon">üîç</span>
                    <input id="searchInput" class="search-input" type="text"
                           placeholder="Search patients by name, ID or email..." />
                </div>

                <div class="topbar-actions">
                    <button class="chip-ai" type="button" id="aiHelperBtn">
                        <span class="icon">‚ö°</span>
                        <span>AI Assistance</span>
                    </button>
                    <button class="btn-round" type="button" title="Notifications">üîî</button>
                    <div class="avatar">PH</div>
                </div>
            </div>

            <div class="page-header">
                <div class="page-header-left">
                    <h1>Patient List</h1>
                    <span id="medicineCountSubtitle">All registered patients</span>
                </div>
                <div class="page-header-right">
                    <div class="filter-group">
                        <label class="filter-label" for="genderFilter">Gender</label>
                        <select id="genderFilter" class="select-input">
                            <option value="">All Genders</option>
                            <option value="Male">Male</option>
                            <option value="Female">Female</option>
                        </select>
                    </div>

                    {% if session.role == "admin" %}
                    <button class="btn-primary" type="button" id="newPatientBtn">
                        <span class="icon">Ôºã</span>
                        <span>New Patient</span>
                    </button>
                    {% endif %}
                </div>
            </div>

            <section class="content-card">
                <div class="content-toolbar">
                    <div class="content-toolbar-left">
                        <div class="pill-count" id="patientCountPill">0 patients</div>
                        <span id="filterSummary">Showing all patients</span>
                    </div>
                </div>

                <div class="medicine-grid" id="patientGrid" 
                     data-api-url="/patients/api/patients">
                    {% if patients %}
                        {% for patient in patients %}
                        <div class="medicine-card" data-id="{{ patient.patient_id }}">
                            <div class="badge-id">{{ patient.patient_id }}</div>
                            <div class="medicine-card-header">
                                <!-- PATIENT INITIALS AVATAR -->
                                <div class="medicine-avatar">
                                    {% set name_parts = patient.full_name.split(' ') %}
                                    {{ name_parts[0][:1] }}{% if name_parts|length > 1 %}{{ name_parts[1][:1] }}{% endif %}
                                </div>
                                <div>
                                    <div class="medicine-title">{{ patient.full_name }}</div>
                                    <div class="medicine-subtitle">Age: {{ patient.age }} ‚Ä¢ {{ patient.gender }}</div>
                                </div>
                            </div>
                            <div class="medicine-meta">
                                <span>Email: <strong>{{ patient.email }}</strong></span>
                                <span>DOB: <strong>{{ patient.dob }}</strong></span>
                            </div>
                            <div class="medicine-footer">
                                <div class="stock-status stock-healthy">
                                    <span class="dot"></span>
                                    <span>Active</span>
                                </div>
                                <div class="card-actions">
                                    <button class="btn-mini buy" data-action="view" data-id="{{ patient.patient_id }}">View</button>
                                </div>
                            </div>
                            <div class="medicine-meta" style="margin-top:8px; padding-top:8px; border-top:1px solid rgba(229, 231, 235, 0.6);">
                                <span>Address: <strong>{{ patient.address }}</strong></span>
                                <span style="padding: 2px 8px; border-radius: 999px; background: #dcfce7; color: #15803d; font-size: 11px;">Emergency: {{ patient.emergency_contact }}</span>
                            </div>
                        </div>
                        {% endfor %}
                    {% else %}
                        <div style="text-align: center; padding: 2rem; color: #666;">
                            <p>No patients found in the database.</p>
                        </div>
                    {% endif %}
                </div>
            </section>
        </main>
    </div>

    <div id="toast" class="toast hidden">
        <div id="toastMessage"></div>
    </div>

    <div id="newPatientModal" class="modal-overlay hidden">
    <div class="modal-container">
        <div class="modal-header">
            <h2>Add New Patient</h2>
            <button class="modal-close" id="closeModalBtn" type="button">&times;</button>
        </div>
        <form id="newPatientForm" class="modal-form">
            <div class="form-group">
                <label for="fullName">Full Name <span class="required">*</span></label>
                <input type="text" id="fullName" name="full_name" required placeholder="Enter full name" />
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="email">Email <span class="required">*</span></label>
                    <input type="email" id="email" name="email" required placeholder="user@example.com" />
                </div>
                <!-- PHONE FIELD REMOVED -->
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label for="dob">Date of Birth <span class="required">*</span></label>
                    <input type="date" id="dob" name="dob" required />
                </div>
                <div class="form-group">
                    <label for="gender">Gender <span class="required">*</span></label>
                    <select id="gender" name="gender" required>
                        <option value="">Select Gender</option>
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                        <option value="Other">Other</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label for="address">Address <span class="required">*</span></label>
                <input type="text" id="address" name="address" required placeholder="Street, City, Country" />
            </div>
            <div class="form-group">
                <label for="emergencyContact">Emergency Contact <span class="required">*</span></label>
                <input type="text" id="emergencyContact" name="emergency_contact" required placeholder="Name and phone" />
            </div>
            <div class="modal-actions">
                <button type="button" class="btn-cancel" id="cancelBtn">Cancel</button>
                <button type="submit" class="btn-submit">Add Patient</button>
            </div>
        </form>
    </div>
</div>

    <script>
        document.getElementById("aiHelperBtn").addEventListener("click", function() {
            window.location.href = "/chatbot-page";
        });
    </script>

    <script src="{{ url_for('static', filename='scripts/patients.js') }}"></script>
</body>
</html>